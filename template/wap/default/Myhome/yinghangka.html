<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
<script type="text/javascript" src="__PUBLIC__/static/js/jquery.min.js"></script>
<title>绑定银行卡</title>
<style>
*{margin: 0;padding: 0;}
.big_content{width: 100%;margin: 0 auto;height: auto;}
.header{width: 100%;height: 40px;margin: 0 auto;background-color: #f5f5f5;text-align: center;}
.header span{text-align: center;color: #a9a6a6;line-height: 40px;font-size: 1rem;}
.form_1{width: 100%;height: auto;margin: auto;}
#form1{width: 100%;height: auto;margin: auto;}
#form1 p{height: 45px;line-height: 35px;display: block;width: 95%;padding-left: 5%;border-bottom: 1px solid #dbdbdb;margin: 10px 0;font-size: 1.1rem;}
#form1 input{overflow: hidden;white-space: nowrap;text-overflow: ellipsis;outline: none;height: 30px;line-height: 30px;display:inline-block;font-size: 1rem;width: 50%;border:none;padding-left: 20px;color: #a8a8a8;}
#takepicture_1{width: 15%;height: 32px; margin-right: 5%;border:none; background: url(__INDEX__/images/camera_03.png) no-repeat;display: inline-block;float: right;outline: none;padding-left: 0px;}
#takepicture{width: 100% !important;height: 32px !important;border:none !important; background: url(__INDEX__/images/camera_03.png) no-repeat !important;display: inline-block !important;float: right !important;outline: none !important;padding-left: 0px !important;opacity: 0;}
.images{width: 100%;height: auto;text-align: center;}
#preview{max-width: 100%;height: auto;display: inline-block;margin:auto;}
.next{width: 90%;margin: 0 auto;}
.next input{width: 100%;height: 50px; margin: auto;background: #ff6364;border: none;outline: none;color: #fff;font-size: 1.2rem;}
</style>
</head>
<body>
  <div class="big_content">
  	<div class="header">
  		<span>请绑定持卡人本人的银行卡</span>
  	</div>
  	<div class="form_1">
  		<form id="form1">
  		<p>持卡人：<input name="userName" type="text" id="txtUserName"size="15" placeholder="持卡人姓名"  placeholder="持卡人姓名" onfocus="if (placeholder =='持卡人'){placeholder =''}" onblur="if (placeholder ==''){placeholder='持卡人姓名'}"/></p>
        <p>卡 &nbsp 号：<input name="kahao" type="number"  id="cardnum"   size="15" placeholder="请输入银行卡号" onfocus="if (placeholder =='请输入银行卡号'){placeholder =''}" onblur="checkCard()"/>
		<span id="takepicture_1">
		<input class="btn" id="takepicture" type="file" onchange="javascript:setImagePreview();"/></span>
		</p>
        <div class="images" id="localImag">
        	<img id="preview" width="-1" height="-1" style="display: none" />
        </div>
        <p>卡类型：<input name="type" style="font-size:0.8rem;width:68%;" type="text" id="cardtype" size="15" placeholder="银行卡类型" onfocus="if (placeholder =='银行卡类型'){placeholder =''}" onblur="if (placeholder ==''){placeholder='银行卡类型'}"/></p>
        <p>手机号：<input name="telnumber" type="number" id="tel"size="15" placeholder="请输入预留手机号码" onfocus="if (placeholder =='请输入预留手机号码'){placeholder =''}" onblur="if (placeholder ==''){placeholder='请输入预留手机号码'}"/></p>
  		</form>
  		<div class="next">
  			<input type="submit" value="下一步" id="next" />
  		</div>
  	</div>
  </div>
  <script type="text/javascript">
         function setImagePreview() {  
            var preview, img_txt, localImag, takepicture = document.getElementById("takepicture"),  
            picture = takepicture.value;  
            if (!picture.match(/.jpg|.gif|.png|.bmp/i)) return alert("您上传的图片格式不正确，请重新选择！"),  
            !1;  
            if (preview = document.getElementById("preview"), takepicture.files && takepicture.files[0]) preview.style.display = "block",  
                preview.style.width = "200px",  
                preview.style.height = "150px",  
                preview.src = window.navigator.userAgent.indexOf("Chrome") >= 1 || window.navigator.userAgent.indexOf("Safari") >= 1 ? window.URL.createObjectURL(takepicture.files[0]) : window.URL.createObjectURL(takepicture.files[0]);  
            else {  
                takepicture.select(),  
                takepicture.blur(),  
                img_txt = document.selection.createRange().text,  
                localImag = document.getElementById("localImag"),  
                localImag.style.width = "200px",  
                localImag.style.height = "150px";  
                try {  
                    localImag.style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)",  
                    localImag.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src = img_txt  
                } catch(f) {  
                    return alert("您上传的图片格式不正确，请重新选择！"),  
                    !1  
                }  
                preview.style.display = "none",  
                document.selection.empty()  
            }  
             
        }  
</script>
   <script type="text/javascript">
        $(document).ready(function () {
            $("#next").click(function () {
            	var username = $('#txtUserName').val();
                var kahao = $('#cardnum').val();
                var phone = $('#tel').val();
                var strBin="10,18,30,35,37,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,58,60,62,65,68,69,84,87,88,94,95,98,99";   
                var Mobile = /^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
				var pic = $("#preview")[0].src;
                if(username === ''){
                	alert("请输入持卡人姓名");
                    return false;
                }else if(kahao === '' && pic === ''){
                	alert("请输入银行卡号");
                    return false;
                }else if(phone === ''){
                	alert("预留手机号码不能为空");
                    return false;
                }else if(!username.match( /^[\u4E00-\u9FA5]{1,}$/)){
                	alert("请填写正确的姓名");
                    return false;
                }else if(kahao =="" || kahao.length < 16 || kahao.length > 19){
                	alert("银行卡号数必须在16到19之间");
                	return false;
                }else if(strBin.indexOf(kahao.substring(0, 2))== -1){
                	alert("银行卡号开头6位不符合规范");
                	return false;
                }else if(!Mobile.test(phone)){
                	alert("请输入有效的手机号码!");
                }else{
            $.ajax({  
                type: "POST",   //提交的方法
                url:"/home/request", //提交的地址  url
                data:$('#form1').serialize(),// 序列化表单值 表单id 
                async: false,  //是否同步
                error: function(request) {  //失败的话
                     alert("Connection error");  
                },  
                success: function(data) {  //成功
                     alert(data);  //就将返回的数据显示出来
                     window.location.href="跳转页面"  
                }  
             });
          }
       });  
});

	function checkCard(){
		var cardNum = $('#cardnum').val();
		var url = "{:url('Myhome/checkCards')}";
    var datas = {cardNum:cardNum};
		$.post(url,datas,function(res){
            if(res){
              $('#cardtype').empty().val(res);
            }
		},'json')


	}

    </script>
</body>
</html>

 